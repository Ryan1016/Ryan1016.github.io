---
title: 拦截器
layout: post
categories: J2EE
---

## 一、拦截器概述
### （一）什么是拦截器
&emsp;&emsp;Spring MVC中的拦截器（Interceptor）类似于Servlet中的过滤器（Filter），它主要用于拦截用户请求并作相应的处理。例如通过拦截器可以进行权限验证、记录请求信息的日志、判断用户是否登录等。

### （二）拦截器的定义
&emsp;&emsp;要使用Spring MVC中的拦截器，就需要对拦截器类进行定义和配置。通常拦截器类可以通过两种方式来定义。

**第一种:** 通过实现HandlerInterceptor接口，或继承HandlerInterceptor接口的实现类（如HandlerInterceptorAdapter）来定义。

**第二种:** 通过实现WebRequestInterceptor接口，或继承WebRequestInterceptor接口的实现类来定义。
```java
public class CustomInterceptor implements HandlerInterceptor{
    public boolean preHandle(HttpServletRequest request, 
HttpServletResponse response, Object handler)throws Exception {
return false;
}
public void postHandle(HttpServletRequest request, 
HttpServletResponse response, Object handler, 
ModelAndView modelAndView) throws Exception {
}
public void afterCompletion(HttpServletRequest request, 
	HttpServletResponse response, Object handler, 
	Exception ex) throws Exception {		
  }
}
```
**Tips:** 
- preHandle：该方法会在控制器方法前执行，其返回值表示是否中断后续操作。当其返回值为true时，表示继续向下执行；当其返回值为false时，会中断后续的所有操作。
- postHandle：该方法会在控制器方法调用之后，且解析视图之前执行。可以通过此方法对请求域中的模型和视图做出进一步的修改。
- afterCompletion：该方法会在整个请求完成，即视图渲染结束之后执行。可以通过此方法实现一些资源清理、记录日志信息等工作。

### （三）拦截器的配置
&emsp;&emsp;要使自定义的拦截器类生效，还需要在Spring MVC的配置文件中进行配置。
```xml
    <mvc:interceptors>
        <bean class="com.ryan.interceptor.CustomInterceptor"/>
       <mvc:interceptor>
            <mvc:mapping path="/**"/>
            <mvc:exclude-mapping path=""/>
            <bean class="com.ryan.interceptor.Interceptor1" /> 
       </mvc:interceptor>
       <mvc:interceptor>
            <mvc:mapping path="/hello"/>
            <bean class="com.ryan.interceptor.Interceptor2" />	   
        </mvc:interceptor>
        ...
     </mvc:interceptors>
```
**Tips：** 
-  <bean class="com.ryan.interceptor.CustomInterceptor"/>：全局拦截器，拦截所有的请求。
-   <mvc:mapping path="/**"/>：表示拦截所有路径。
-  <mvc:exclude-mapping path=""/>：配置不需要拦截的路径。
-   <mvc:mapping path="/hello"/>：/hello表示拦截所有以/hello结尾的路径。

<font color="red">注意：<mvc:interceptor>中的子元素必须按照上述代码的配置顺序进行编写，否则文件会报错。</font>

## 二、拦截器的执行流程
### （一）单个拦截器的执行流程
![单个拦截器](https://img-blog.csdnimg.cn/20200323100156117.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDIyNDQ4,size_1,color_FFFFFF,t_0)
### （二）多个拦截器执行流程

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200323100644939.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDIyNDQ4,size_1,color_FFFFFF,t_0)

## 三、运行结果
1. 用户登录（用户名为：ryan；密码为：123.如果两者有一个不匹配，则会有错误提示）
![登录](https://img-blog.csdnimg.cn/20200323105458668.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDIyNDQ4,size_1,color_FFFFFF,t_0)
![错误提示](https://img-blog.csdnimg.cn/20200323105526849.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDIyNDQ4,size_1,color_FFFFFF,t_70)
![成功](https://img-blog.csdnimg.cn/20200323110335698.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDIyNDQ4,size_1,color_FFFFFF,t_70)

2. 退出登录
![退出](https://img-blog.csdnimg.cn/20200323110408408.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDIyNDQ4,size_1,color_FFFFFF,t_70)
3. 控制台输出信息
![控制台](https://img-blog.csdnimg.cn/20200323110513413.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDIyNDQ4,size_1,color_FFFFFF,t_70)




---
**<font color="red">最后的最后，欢迎查看我的CSDN博客：</font>[Welcome To Ryan's Home](https://blog.csdn.net/qq_41422448/article/details/104891224)**

---